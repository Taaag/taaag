<div class="row tagrank">
    <img class="profile-taglist-img" src="https://graph.facebook.com/{{ user.id }}/picture?type=large">
</div>
<div class="row tagrank">

    <div class="profile-taglist">
        <table class="table profile-taglist-table">
            {% for tag in tags %}
                <tr class="my-tag-set">
                    <th class="col-sm-1 th-detele-btn">
                        <div class="mytaglist-delete-btn"><i class="fa fa-times"></i></div>
                    </th>
                    <th class="col-sm-1 th-upvote-num">
                        <div class="mytag-upvote-circle"><p class="mytag-upvote-num">{{ tag.taggers|length }}</div>
                    </th>
                    <th class="col-sm-5 taglist-th-tn"><p class="mytag-tagname-font">{{ tag.name }}</p></th>
                    <th class="col-sm-4">
                        <!-- 循环照片。。。 -->
                        {% for tagger in tag.taggers[0:4] %}
                            <div class="mytag-img th-mytag-img" data-uid="{{ tagger.id }}" title="{{ tagger.name }}">
                                <img class="voter-img" src="https://graph.facebook.com/{{ tagger.id }}/picture">
                            </div>
                        {% endfor %}
                        {#                        <div class="mytag-img .th-mytag-img"></div>#}
                    </th>
                    <th class="col-sm-1 th-mytag-viewmore" data-index="{{ loop.index0 }}">
                        <span class="span-viewmore"><i class="fa fa-caret-right"></i></span>
                    </th>
                    <th class="col-sm-1 th-mytag-scroll">

                    </th>
                </tr>
            {% endfor %}
        </table>
    </div>

    <!--     <div id="dialog" title="Basic dialog">
        <p>This is an animated dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
        </div> -->

</div>

<script>
    $(function () {
        
        $(".mytag-img").click(function () {
            $(document).trigger("viewChanging", ["friend", {'id': $(this).data('uid')}]);
        }).tooltip({placement: "bottom", container: "body"});

        $('.mytaglist-delete-btn').click(function () {
            var $row = $(this).closest('.my-tag-set');
            var tag = $row.find('.mytag-tagname-font').text();
            BootstrapDialog.confirm(
                "Add you sure to delete " + tag + "?", 
                {
                 type: 'none',   
                },
                function (result) {
                if (result) {
                    deleteTag(tag, $row);
                }
            });
        });

        function deleteTag(tag, $row) {
            $.get('/api/delete_tag', {name: tag}, function (response) {
                if (response['succeed']) {
                    $.bootstrapGrowl("Successfully removed " + tag, {align: 'center', 'type': 'success'});
                    $row.remove();
                } else {
                    $.bootstrapGrowl("Oops, " + response['message'], {align: 'center', 'type': 'warning'});
                }
            });
        }

        var taggers_array = {{ tags|tojson }};

        $('.span-viewmore').click(function () {
            var $row = $(this).closest('.my-tag-set');
            var tag = $row.find('.mytag-tagname-font').text();
            var upvoteNum = $row.find('.mytag-upvote-num').text();
            var index = $(this).attr('data-index');
            console.log(taggers_array[index]);
            var msg = '<table><tbody><tr><td><div class = "dialog-img"></div></td><td><p class = "dialog-name" >Vicky Zheng Yuan</div></row></td></tr><tbody><table>';
            BootstrapDialog.show({
                title:'' + upvoteNum + ' people have upvoted ' + tag + '',
                message: msg,
                type: 'none',
                closable: true,
                size: BootstrapDialog.SIZE_SMALL,
                cssClass: 'upvoteList-dialog'
            });
        });
    });


    // $(function() {
    //   $( "#dialog" ).dialog({
    //     autoOpen: false,
    //     show: {
    //       effect: "blind",
    //       duration: 1000
    //     },
    //     hide: {
    //       effect: "explode",
    //       duration: 1000
    //     }
    //   });

    //   $( ".img-viewmore" ).click(function() {
    //     $( "#dialog" ).dialog( "open" );
    //   });
    // });


</script>
