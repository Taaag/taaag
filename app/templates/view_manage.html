<div class="row tagrank">
    <img class="profile-taglist-img" src="https://graph.facebook.com/{{ user.id }}/picture?type=large">
</div>
<div class="row tagrank">

    <div class="profile-taglist">
        <table class="table profile-taglist-table">
            <tbody id="tag-votes-table">
            {% for tag in tags_order_by_votes %}
                <tr class="my-tag-set">
                    <th class="col-sm-1 th-detele-btn">
                        <div class="mytaglist-delete-btn"><i class="fa fa-times"></i></div>
                    </th>
                    <th class="col-sm-1 th-upvote-num">
                        <div class="mytag-upvote-circle"><p class="mytag-upvote-num">{{ tag.taggers|length }}</div>
                    </th>
                    <th class="col-sm-5 taglist-th-tn"><p class="mytag-tagname-font">{{ tag.name }}</p></th>
                    <th class="col-sm-4">
                        <!-- 循环照片。。。 -->
                        {% for tagger in tag.taggers[0:5] %}
                            <div class="mytag-img th-mytag-img" data-uid="{{ tagger.id }}" title="{{ tagger.name }}">
                                <img class="voter-img" src="https://graph.facebook.com/{{ tagger.id }}/picture">
                            </div>
                        {% endfor %}
                        {#                        <div class="mytag-img .th-mytag-img"></div>#}
                    </th>
                    <th class="col-sm-1 th-mytag-viewmore">
                        <span class="span-viewmore" data-index="{{ loop.index0 }}"><i
                                class="fa fa-caret-right"></i></span>
                    </th>
                    <th class="col-sm-1 th-mytag-scroll">

                    </th>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!--     <div id="dialog" title="Basic dialog">
        <p>This is an animated dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
        </div> -->

</div>
<div class="row tagrank">
    <button id="manage-to-view-btn">Check out your tag cloud!</button>
</div>

<script>
    $(function () {
        var tags_order_by_time = {{ tags_order_by_time|tojson }};
        var time_table = '<tbody id="tag-time-table">';
        $.each(tags_order_by_time, function (index, tag) {
            time_table += '<tr><td class="col-sm-1"></td><td class="col-sm-5">' + tag.name +
                          '</td><td class="col-sm-6">' + tag.created_time + '</td></tr>';
        });
        time_table += '</tbody>';
        console.log(time_table);
        $('.profile-taglist-table').html(time_table);

        $('#manage-to-view-btn').click(function () {
            $(document).trigger("viewChanging", ["me", {}]);
        });

        $(".mytag-img").click(function () {
            $(document).trigger("viewChanging", ["friend", {'id': $(this).data('uid')}]);
        }).tooltip({placement: "bottom", container: "body"});


        $('.mytaglist-delete-btn').click(function () {
            var $row = $(this).closest('.my-tag-set');
            var tag = $row.find('.mytag-tagname-font').text();
            BootstrapDialog.confirm(
                    {
                        title: 'Detele',
                        type: 'none',
                        message: "<h4> Are you sure to delete " + tag + "? </h4>",
                        size: BootstrapDialog.SIZE_SMALL,
                        closable: true,
                        closeByBackdrop: true,
                        callback: function (result) {
                            if (result) {
                                deleteTag(tag, $row);
                            }
                        }

                    });
        });

        function deleteTag(tag, $row) {
            $.get('/api/delete_tag', {name: tag}, function (response) {
                if (response['succeed']) {
                    $.bootstrapGrowl("Successfully removed " + tag, {align: 'center', 'type': 'success'});
                    $row.remove();
                } else {
                    $.bootstrapGrowl("Oops, " + response['message'], {align: 'center', 'type': 'warning'});
                }
            });
        }

        var tagger_array = {{ tags_order_by_votes|tojson }}

                $('.span-viewmore').click(function () {
                    var $row = $(this).closest('.my-tag-set');
                    var tag = $row.find('.mytag-tagname-font').text();
                    var upvoteNum = $row.find('.mytag-upvote-num').text();
                    var index = parseInt($(this).attr('data-index'));
                    var taggers = tagger_array[index]['taggers'];
                    var msg = '<table><tbody>';
                    $.each(taggers, function (index, tagger) {
                        msg += '<tr class="dialog-set"><td class="col-sm-2"><img class="dialog-img" ' +
                                'src="https://graph.facebook.com/' + tagger.id +
                                '/picture"></td><td class="col-sm-10"><p class="dialog-name">' + tagger.name +
                                '</p></td></tr>';
                    });
                    msg += '</tbody></table>';
                    BootstrapDialog.show({
                        title: '<p class = "dialog-title">' + upvoteNum + ' people have upvoted ' + tag + ' </p>',
                        message: msg,
                        type: 'none',
                        closable: true,
                        closeByBackdrop: true,
                        size: BootstrapDialog.SIZE_SMALL,
                        cssClass: 'upvoteList-dialog'
                    });
                });
    });


</script>
